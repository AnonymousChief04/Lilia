--------------------------------------------------------------------------------------------------------
lia.config.RestrictedEntityList = {"prop_door_rotating", "lia_vendor",}
lia.config.BlockedEntities = {"ent_chess_board", "ent_draughts_board", "rock_big", "rock_medium", "rock_small ", "lia_bodygroupcloset", "lia_craftingtable", "carvendor", "sh_teller", "permaweapons", "stockbook", "lia_stash", "valet", "lia_vendor", "telephone", "lia_salary", "spruce", "pinetree", "oaktree", "beechtree", "npc_import_drug", "cardealer", "delivery_crate", "npcdelivery", "housing_npc", "jailer_npc", "sergeant_dornan", "npctaxi",}
lia.config.DuplicatorBlackList = {"lia_storage", "lia_money"}
lia.config.RestrictedVehicles = {"sim_fphys_chaos126p", "sim_fphys_hedgehog", "sim_fphys_ratmobile", "sim_fphys_tank2", "sim_fphys_tank", "sim_fphys_conscriptapc_armed", "sim_fphys_combineapc_armed", "sim_fphys_jeep_armed2", "sim_fphys_jeep_armed", "sim_fphys_tank3", "sim_fphys_v8elite_armed2", "sim_fphys_v8elite_armed", "sim_fphys_tank4", "sim_fphys_couch", "sim_fphys_couch", "sim_fphys_tank_sdkfz_halftrack", "sim_fphys_opel_blitz_ww2", "gred_simfphys_panzerivd", "gred_simfphys_panzerivf1", "gred_simfphys_panzerivf2", "sim_fphys_pwavia", "sim_fphys_pwgaz52", "sim_fphys_pwhatchback", "sim_fphys_pwhatchback", "sim_fphys_pwmoskvich", "sim_fphys_pwtrabant", "sim_fphys_pwtrabant02", "sim_fphys_pwvan", "sim_fphys_pwvolga", "sim_fphys_pwzaz", "sim_fphys_conscriptapc", "sim_fphys_combineapc", "sim_fphys_jeep", "sim_fphys_jalopy", "sim_fphys_v8elite", "sim_fphys_van", "sim_fphys_chaos126p", "sim_fphys_hedgehog", "sim_fphys_ratmobile", "sim_fphys_tank2", "sim_fphys_tank", "sim_fphys_conscriptapc_armed", "sim_fphys_combineapc_armed", "sim_fphys_jeep_armed2", "sim_fphys_jeep_armed", "sim_fphys_tank3", "sim_fphys_v8elite_armed2", "sim_fphys_v8elite_armed", "sim_fphys_tank4", "sim_fphys_couch", "sim_fphys_dukes", "sim_fphys_tank_sdkfz_halftrack", "sim_fphys_opel_blitz_ww2", "gred_simfphys_panzerivd", "gred_simfphys_panzerivf1", "gred_simfphys_panzerivf2", "sim_fphys_pwavia", "sim_fphys_pwgaz52", "sim_fphys_pwhatchback", "sim_fphys_pwliaz", "sim_fphys_pwmoskvich", "sim_fphys_pwtrabant", "sim_fphys_pwtrabant02", "sim_fphys_pwvan", "sim_fphys_pwvolga", "sim_fphys_pwzaz", "sim_fphys_conscriptapc", "sim_fphys_combineapc", "sim_fphys_jeep", "sim_fphys_jalopy", "sim_fphys_v8elite", "sim_fphys_van", "gred_simfphys_panzerivd", "avx_t-34-85", "sim_fphys_chaos126p", "sim_fphys_hedgehog", "sim_fphys_ratmobile", "sim_fphys_tank2", "sim_fphys_tank", "sim_fphys_conscriptapc_armed", "sim_fphys_combineapc_armed", "sim_fphys_jeep_armed2", "sim_fphys_jeep_armed", "sim_fphys_tank3", "sim_fphys_v8elite_armed2", "sim_fphys_v8elite_armed", "sim_fphys_tank4", "sim_fphys_couch", "sim_fphys_dukes", "sim_fphys_conscriptapc", "sim_fphys_combineapc", "sim_fphys_jeep", "sim_fphys_jalopy", "sim_fphys_v8elite", "sim_fphys_van", "gred_panzerivd", "gred_simfphys_panzerivf1", "gred_simfphys_panzerivf2", "T34rp", "t34_76rp", "T34_85rp", "T34", "t34_76", "sdkfz_234", "ps_sdkfz_251_armed", "gb_bomb_cbu", "gb_bomb_1000gp", "gb_bomb_2000gp", "gb_bomb_fab250", "gb_bomb_gbu12", "gb_bomb_250gp", "gb_bomb_500gp", "gb_bomb_gbu38", "gb_bomb_mk77", "gb_bomb_mk82", "gb_bomb_sc100", "gb_bomb_sc1000", "gb_bomb_sc250", "gb_bomb_sc500", "gb_rocket_hvar", "gb_rocket_hydra", "gb_rocket_nebel", "gb_rocket_rp3", "gb_rocket_v1", "gred_ammobox", "sdkfz", "sdkfz2w", "sim_fphys_tank2", "Airboat", "Jeep", "Pod", "sim_fphys_chaos126p", "sim_fphys_hedgehog", "sim_fphys_ratmobile", "sim_fphys_tank2", "sim_fphys_tank", "sim_fphys_conscriptapc_armed", "sim_fphys_combineapc_armed", "sim_fphys_jeep_armed2", "sim_fphys_jeep_armed", "sim_fphys_tank3", "sim_fphys_v8elite_armed2", "sim_fphys_v8elite_armed", "sim_fphys_tank4", "sim_fphys_couch", "sim_fphys_dukes", "sim_fphys_tank_sdkfz_halftrack", "sim_fphys_opel_blitz_ww2", "gred_simfphys_panzerivd", "gred_simfphys_panzerivf1", "gred_simfphys_panzerivf2", "sim_fphys_pwavia", "sim_fphys_pwgaz52", "sim_fphys_pwhatchback", "sim_fphys_pwhatchback", "sim_fphys_pwmoskvich", "sim_fphys_pwtrabant", "sim_fphys_pwtrabant02", "sim_fphys_pwvan", "sim_fphys_pwvolga", "sim_fphys_pwzaz", "sim_fphys_conscriptapc", "sim_fphys_conscriptapc", "sim_fphys_jeep", "sim_fphys_jalopy ", "sim_fphys_v8elite", "sim_fphys_van", "T34_85"}
--------------------------------------------------------------------------------------------------------
function GM:PlayerSpawnNPC(client)
    if not client:getChar() then return false end
    if CAMI.PlayerHasAccess(client, "Lilia - Management - Can Spawn NPCs", nil) then return true end

    return client:getChar():hasFlags("n") or client:getChar():hasFlags("E")
end
--------------------------------------------------------------------------------------------------------
function GM:PlayerSpawnProp(client)
    if not client:getChar() then return false end
    if CAMI.PlayerHasAccess(client, "Lilia - Management - Can Spawn Props", nil) then return true end
    if FindMetaTable("Player").GetLimit then
        local limit = client:GetLimit("props")
        if limit < 0 then return end
        local props = client:GetCount("props") + 1
        if client:getLiliaData("extraProps") then
            if props > (limit + 50) then
                client:LimitHit("props")

                return false
            end
        else
            if props > limit then
                client:LimitHit("props")

                return false
            end
        end
    end

    return client:IsAdmin() or client:getChar():hasFlags("e")
end
--------------------------------------------------------------------------------------------------------
function GM:PlayerSpawnRagdoll(client)
    if not client:getChar() then return false end
    if CAMI.PlayerHasAccess(client, "Lilia - Management - Can Spawn Ragdolls", nil) then return true end
    if FindMetaTable("Player").GetLimit then
        local limit = ply:GetLimit("ragdolls")
        if limit < 0 then return end
        local ragdolls = ply:GetCount("ragdolls") + 1
        if ragdolls > limit then
            ply:LimitHit("ragdolls")

            return false
        end
    end

    return client:getChar():hasFlags("r")
end
--------------------------------------------------------------------------------------------------------
function GM:PlayerSpawnSWEP(client)
    if not client:getChar() then return false end
    if CAMI.PlayerHasAccess(client, "Lilia - Management - Can Spawn SWEPs", nil) then return true end

    return client:getChar():hasFlags("W")
end
--------------------------------------------------------------------------------------------------------
function GM:PlayerSpawnEffect(client)
    if not client:getChar() then return false end
    if CAMI.PlayerHasAccess(client, "Lilia - Management - Can Spawn Effects", nil) then return true end

    return client:getChar():hasFlags("n") or client:getChar():hasFlags("E")
end
--------------------------------------------------------------------------------------------------------
function GM:PlayerSpawnSENT(client)
    if not client:getChar() then return false end
    if CAMI.PlayerHasAccess(client, "Lilia - Management - Can Spawn SENTs", nil) then return true end

    return client:getChar():hasFlags("E")
end

--------------------------------------------------------------------------------------------------------
function GM:PlayerSpawnVehicle(client, model, name, data)
    if not client:getChar() then return false end
    if table.HasValue(lia.config.RestrictedVehicles, name) then
        ply:notify("You can't spawn this vehicle since it's restricted!")

        return CAMI.PlayerHasAccess(client, "Lilia - Management - Can Spawn Restricted Cars", nil)
    else
        return client:getChar():hasFlags("C") or CAMI.PlayerHasAccess(client, "Lilia - Management - Can Spawn Cars", nil)
    end
end
--------------------------------------------------------------------------------------------------------
function GM:CanTool(client, trace, tool)
    local privilege = "Lilia - Management - Access Tool " .. tool:gsub("^%l", string.upper)
    local entity = trace.Entity
    if not client:getChar() then return false end
    if not client:getChar():hasFlags("t") then return false end
    if tool == "advdupe2" and table.HasValue(lia.config.DuplicatorBlackList, entity:GetClass()) then return false end
    if tool == "remover" and table.HasValue(lia.config.BlockedEntities, entity:GetClass()) then return CAMI.PlayerHasAccess(client, "Lilia - Management - Can Remove Blocked Entities", nil) end
    if CAMI.PlayerHasAccess(client, privilege, nil) then return true end
end
--------------------------------------------------------------------------------------------------------
function GM:PhysgunPickup(client, entity)
    if not client:getChar() then return false end
    if client:IsSuperAdmin() then return true end
    if entity:GetCreator() == client and entity:GetClass() == "prop_physics" then return true end
    if CAMI.PlayerHasAccess(client, "Lilia - Management - Physgun Pickup", nil) then
        if table.HasValue(lia.config.RestrictedEntityList, entity:GetClass()) then
            if CAMI.PlayerHasAccess(client, "Lilia - Management - Physgun Pickup on Restricted Entities", nil) then
                return true
            else
                return false
            end
        elseif entity:IsVehicle() then
            if CAMI.PlayerHasAccess(client, "Lilia - Management - Physgun Pickup on Vehicles", nil) then
                return true
            else
                return false
            end
        end
    else
        return false
    end
end
--------------------------------------------------------------------------------------------------------
function GM:CanProperty(client, property, entity)
    if not client:getChar() then return false end
    if client:IsSuperAdmin() then return true end
    if CAMI.PlayerHasAccess(client, "Lilia - Management - Access Tool " .. property:gsub("^%l", string.upper), nil) then
        if table.HasValue(lia.config.BlockedEntities, entity:GetClass()) or table.HasValue(lia.config.RestrictedEntityList, entity:GetClass()) then
            return CAMI.PlayerHasAccess(client, "Lilia - Management - Use Entity Properties on Blocked Entities", nil)
        else
            return true
        end
    else
        return false
    end
end

--------------------------------------------------------------------------------------------------------
function GM:PlayerCheckLimit(ply, name)
    if FindMetaTable("Player").GetLimit then
        if name == "props" then
            if ply:GetLimit("props") < 0 then return end
            if ply:getLiliaData("extraProps") then
                local limit = ply:GetLimit("props") + 50
                local props = ply:GetCount("props")
                if props <= limit + 50 then return true end
            end
        end
    end
end
--------------------------------------------------------------------------------------------------------